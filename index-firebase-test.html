<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Confident Picks - Firebase Test</title>

<link rel="icon" href="/favicon.ico" sizes="any">
<link rel="icon" href="/logo.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="#0B0F14">

<meta name="description" content="Firebase integration test for Confident Picks">
<meta property="og:title" content="Confident Picks - Firebase Test">
<meta property="og:description" content="Testing Firebase integration">
<meta property="og:type" content="website">
<meta property="og:url" content="https://confident-picks.com">
<meta name="twitter:card" content="summary_large_image">

<!-- Firebase SDK v9+ -->
<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js';
import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js';
import { getAuth } from 'https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js';

const firebaseConfig = {
  apiKey: "AIzaSyA48rKRZiwka1h3_GA3hVNxk8WjOAKpM6U",
  authDomain: "confident-picks-app-8-25.firebaseapp.com",
  projectId: "confident-picks-app-8-25",
  storageBucket: "confident-picks-app-8-25.firebasestorage.app",
  messagingSenderId: "560353454758",
  appId: "1:560353454758:web:0d0a6eb9f1892669ab2267",
  measurementId: "G-PDFMST5FZW"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// Make db available globally
window.db = db;
window.auth = auth;

console.log('üî• Firebase initialized successfully');
console.log('üìä Database:', db);
</script>

<style>
:root{
  --bg:#0B0F14; --card:#121820; --text:#E6EDF3; --sub:#98A6B3;
  --blue:#4DA3FF; --green:#22C55E; --red:#FF6B6B; --border:#ffffff18; --r:12px;
}
:root[data-theme="light"]{
  --bg:#ffffff; --card:#F4F6F8; --text:#0B0F14; --sub:#475569; --border:#00000014;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:Inter,system-ui,Segoe UI,Arial;background:var(--bg);color:var(--text); color-scheme: dark;}
:root[data-theme="light"] body{ color-scheme: light; }

.container{max-width:1024px;margin:0 auto;padding:16px}
.hidden{display:none}
.header{position:sticky;top:0;background:rgba(0,0,0,.2);backdrop-filter:blur(8px);border-bottom:1px solid var(--border);z-index:1000}
.row{display:flex;gap:12px;align-items:center;justify-content:space-between}
.logo{display:flex;align-items:center;gap:8px}
.logo .brandmark{ width:28px; height:28px; display:inline-block; }
.logo strong{ letter-spacing:.2px; }

.btn{padding:8px 12px;border-radius:var(--r);border:1px solid var(--border);background:rgba(255,255,255,.06);color:var(--text);cursor:pointer}
.btn.primary{background:var(--blue);color:#0B0F14;border-color:transparent}
.btn:hover{background:rgba(255,255,255,.12)}

.card{background:var(--card);border-radius:var(--r);border:1px solid var(--border);padding:12px;margin-bottom:12px}
.text-sub{color:var(--sub);font-size:14px}
.status{display:inline-block;padding:2px 8px;border-radius:4px;font-size:12px;font-weight:600}
.status.success{background:rgba(34,197,94,0.2);color:var(--green)}
.status.error{background:rgba(255,107,107,0.2);color:var(--red)}
.status.loading{background:rgba(77,163,255,0.2);color:var(--blue)}

.pick-card{border-left:4px solid var(--blue);}
.pick-card .pick-desc{font-weight:600;margin-bottom:4px}
.pick-card .pick-details{font-size:12px;color:var(--sub)}
</style>
</head>
<body>

<div class="header">
  <div class="container row">
    <div class="logo">
      <svg class="brandmark" viewBox="0 0 48 48" aria-hidden="true">
        <defs><linearGradient id="g1" x1="6" y1="6" x2="42" y2="42" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#4DA3FF"/><stop offset="1" stop-color="#22C55E"/></linearGradient></defs>
        <rect x="4" y="4" width="40" height="40" rx="10" fill="url(#g1)"/>
        <path d="M14 25 L21 32 L34 17" stroke="#fff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <strong>Confident Picks - Firebase Test</strong>
    </div>
    <div class="row">
      <button class="btn" onclick="testConnection()">Test Connection</button>
      <button class="btn primary" onclick="loadData()">Load Data</button>
    </div>
  </div>
</div>

<div class="container">
  <div class="card">
    <h2>üî• Firebase Integration Test</h2>
    <p class="text-sub">Testing Firebase connection and data loading</p>
    
    <div id="status" class="status loading">Initializing...</div>
    <div id="connection-status" class="text-sub" style="margin-top:8px;"></div>
  </div>

  <div class="card">
    <h3>üìä Firebase Data</h3>
    <div id="data-display">
      <p class="text-sub">Click "Load Data" to fetch picks from Firebase</p>
    </div>
  </div>

  <div class="card">
    <h3>üîß Debug Console</h3>
    <div id="debug-log" style="background:#0B0F14;padding:12px;border-radius:8px;font-family:monospace;font-size:12px;max-height:200px;overflow-y:auto;">
      <div>Console output will appear here...</div>
    </div>
  </div>
</div>

<script>
// Debug logging function
function log(message, type = 'info') {
  const timestamp = new Date().toLocaleTimeString();
  const logDiv = document.getElementById('debug-log');
  const logEntry = document.createElement('div');
  logEntry.style.color = type === 'error' ? '#FF6B6B' : type === 'success' ? '#22C55E' : '#4DA3FF';
  logEntry.textContent = `[${timestamp}] ${message}`;
  logDiv.appendChild(logEntry);
  logDiv.scrollTop = logDiv.scrollHeight;
  console.log(message);
}

// Update status display
function updateStatus(message, type = 'loading') {
  const statusEl = document.getElementById('status');
  statusEl.textContent = message;
  statusEl.className = `status ${type}`;
}

// Test Firebase connection
async function testConnection() {
  updateStatus('Testing connection...', 'loading');
  log('üß™ Testing Firebase connection...');
  
  try {
    // Check if db is available
    if (!window.db) {
      throw new Error('Firebase not initialized yet');
    }
    
    const { collection, getDocs, limit, query } = await import('https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js');
    const testQuery = query(collection(window.db, 'mlb_picks'), limit(1));
    const testDoc = await getDocs(testQuery);
    
    updateStatus('Connection successful!', 'success');
    document.getElementById('connection-status').textContent = `Found ${testDoc.size} documents in mlb_picks collection`;
    log(`‚úÖ Firebase connection successful! Found ${testDoc.size} documents`, 'success');
    return true;
  } catch (error) {
    updateStatus('Connection failed', 'error');
    document.getElementById('connection-status').textContent = `Error: ${error.message}`;
    log(`‚ùå Firebase connection failed: ${error.message}`, 'error');
    return false;
  }
}

// Load data from Firebase
async function loadData() {
  updateStatus('Loading data...', 'loading');
  log('üîÑ Loading data from Firebase...');
  
  try {
    // Check if db is available
    if (!window.db) {
      throw new Error('Firebase not initialized yet');
    }
    
    const { collection, getDocs } = await import('https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js');
    const snapshot = await getDocs(collection(window.db, 'mlb_picks'));
    const dataDisplay = document.getElementById('data-display');
    
    if (snapshot.empty) {
      dataDisplay.innerHTML = '<p class="text-sub">No data found in mlb_picks collection</p>';
      log('üìã No data found in mlb_picks collection', 'error');
      updateStatus('No data found', 'error');
      return;
    }
    
    let html = `<p class="text-sub">Found ${snapshot.size} picks:</p>`;
    
    snapshot.forEach(doc => {
      const data = doc.data();
      html += `
        <div class="pick-card card">
          <div class="pick-desc">${data.awayTeam || 'Away'} vs ${data.homeTeam || 'Home'}</div>
          <div class="pick-details">
            Confidence: ${Math.round(parseFloat(data.confidence || 0) * 100)}% | 
            Prediction: ${data.consensus?.prediction || data.prediction || 'N/A'} | 
            ID: ${doc.id}
          </div>
        </div>
      `;
    });
    
    dataDisplay.innerHTML = html;
    updateStatus(`Loaded ${snapshot.size} picks`, 'success');
    log(`‚úÖ Successfully loaded ${snapshot.size} picks from Firebase`, 'success');
    
  } catch (error) {
    const dataDisplay = document.getElementById('data-display');
    dataDisplay.innerHTML = `<p class="text-sub" style="color:var(--red)">Error loading data: ${error.message}</p>`;
    updateStatus('Data loading failed', 'error');
    log(`‚ùå Data loading failed: ${error.message}`, 'error');
  }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
  log('üöÄ Firebase test page loaded');
  
  // Wait for Firebase to initialize
  setTimeout(() => {
    if (window.db) {
      log('üî• Firebase initialized successfully');
      // Auto-test connection
      testConnection();
    } else {
      log('‚ùå Firebase initialization failed', 'error');
      updateStatus('Firebase initialization failed', 'error');
    }
  }, 2000);
});
</script>

</body>
</html>
